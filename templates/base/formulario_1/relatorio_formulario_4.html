{% extends 'layout/layout.html' %}
{%load static %}
{% load crispy_forms_tags %}
{% block titulo %}Formulário 1.4
{% endblock %}
{% block css %}
<link rel="stylesheet" href={% static "css/styles_relatorio.css" %}>
{% endblock %}
{% block conteudo %}



<style>
  @media print {
    body {
      zoom: 0.85;
    }
  }

  #progressbar {
    width: 0%;
    background-color: #ccc;
  }

  .loading {
    position: fixed;
    display: none;
    z-index: 9999;
    background-color: rgba(255, 255, 255, 0.7);
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .loading:before {
    content: "";
    position: absolute;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    top: 46%;
    left: 50%;
    margin: -10px 0 0 -10px;
    animation: spin 
    2s linear infinite;
  }

  .loading_preloader {
    position: absolute;
    z-index: 9999;
    margin: 0.5rem auto; /* define a margem superior e inferior como 0.5rem e a margem esquerda e direita como automática */
    font-weight: 400;
    line-height: 1.2;
    text-align: center;
    top: 54%; /* posiciona o elemento verticalmente no meio */
    left: 50%; /* posiciona o elemento horizontalmente no meio */
    transform: translate(-50%, -50%); /* move o elemento para a esquerda e para cima em 50% do seu tamanho para centralizá-lo completamente */
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  } 
</style>

<!--plotly-graph-div {
      width: 110% !important;
      height: 30% !important;
      position: relative;
    }
  @media (max-width: 768px) {
    body {
      transform: scale(0.8);
      transform-origin: top left;
    }
  }
    
    display: none; -->

<!-- Begin Page Content -->
<div class="row text-dark">
  <!-- Page Heading -->
  <form class="col mt-0" action="." method="post">
    <h5 class="mt-0 mb-0">Variáveis de contraste e correlação:</h5>
    <hr class="mt-0 mb-2" />
    <div class="row d-flex">
      <div class="col-md-8">
        {% csrf_token %}
        {{ form.questao|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form.ano|as_crispy_field }}
      </div>
    </div>

    <h5 class="mt-0 mb-0"><i class="fas fa-search" style="font-size: 0.8em;"></i>Filtros:</h5>
    <hr class="mt-0 mb-2" />
    <div class="row d-flex">
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.sexo|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.escola|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.cor|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.estado_civil|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.deficiencia|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form_filtro.nacionalidade|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form_filtro.estado|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form_filtro.localizacao_da_escola|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form_filtro.recurso|as_crispy_field }}
      </div>
      <div id="teste" class="col-md-4">
        {% csrf_token %}
        {{ form_filtro.amostra|as_crispy_field }}
      </div>
      <div class="row col">
        <div class="col d-flex align-items-center justify-content-center">
          <button id="preloader2" onclick="geraranalise()" type="submit" class="btn btn-outline-primary">
            Gerar Análise
            <svg xmlns="http://www.w3.org/2000/svg" width="86" height="44" fill="currentColor"
              class="bi bi-clipboard-data" viewBox="0 0 16 16">
              <path
                d="M4 11a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1zm6-4a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V7zM7 9a1 1 0 0 1 2 0v3a1 1 0 1 1-2 0V9z" />
              <path
                d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" />
              <path
                d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    <div class="loading" id="preloader">
      <h4 class="loading_preloader justify-content-center align-items-center">
        Processar todos os dados pode tornar o processo mais pesado e, por isso, pode levar um tempo para ser concluído.
      </h4>
    </div>
    
    
    <hr id="progressbar">
  </form>
</div>


<div class="text-dark rounded border border-dark">


  <div class="col-md-12">
    <h5 class="mt-2 mb-0">{{ menssagem }}</h5>
    <hr class="mt-0 mb-3 bg-dark" />
    <div>
      <h6>
        O número total de alunos após a aplicação do filtro é:
        {{quantidadeParcial}}
      </h6>
      <h6>
        O número total de alunos que se inscreveram no Enem:
        {{quantidadeTotal}}
      </h6>
    </div>
  </div>
  <!-- Relatório em formato de dados brutos -->
  <div class="row">
    <div class="col md-12">
      <hr class="mt-0 mb-3 bg-dark" />
      <div class="col md-11">{{relatorio_dados_brutos|safe}}</div>
    </div>
  </div>

  <!-- Relatório em formato de tabelaa percentual -->
  <div class="row">
    <div class="col md-12">
      <hr class="mt-0 mb-3 bg-dark" />
      <div class="col md-11">{{relatorio_em_tabela|safe}}</div>
    </div>
  </div>
  <hr class="mb-3" />
  <div class="row d-flex justify-content-end align-items-center m-3">
    <div class="col-md-4 d-flex justify-content-end">
      <button id="sidebarToggle" onclick="imprimirComDelay()" type="button" class="btn btn-success print-button">
        <a class="downloader__btn active" href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
            <path
              d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z" />
            <path
              d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z" />
          </svg>
          Baixar o Relatório</a>
      </button>
    </div>
  </div>
</div>

<script>
  // Toggle the side navigation
  function imprimirComDelay() {
    setTimeout(function () {
      window.print();
    }, 100);
  }

  window.onload = function geraranalise() {
    var progressbar = document.getElementById("progressbar");
    var width = 0;
    var id = setInterval(frame, 10);
    function frame() {
      if (width >= 100) {
        clearInterval(id);
      } else {
        width++;
        progressbar.style.width = width + '%';
      }
    }
  };
  
  
  var selectElement = document.getElementById("id_amostra"); // substitua "id_amostra" pelo ID do seu campo de formulário

  // Adicione um ouvinte de eventos para o evento "change" no campo "select"
  selectElement.addEventListener("change", function() {
    var selectedOption = selectElement.options[selectElement.selectedIndex].value;
    
    if (selectedOption == "todos_os_dados") {
      document.getElementById("preloader2").addEventListener("click", function() {
        document.getElementById("preloader").style.display = "block";
      });
    }
  });

    

</script>
<!-- 

-------------------------------------------


-->



{% endblock %}
{% extends 'layout/layout.html' %}
{%load static %}
{% load crispy_forms_tags %}
{% block titulo %}Dados brutos-infor
{% endblock %}
{% block css %}

<link rel="stylesheet" href={% static "css/styles_relatorio.css" %}>
{% endblock %}
{% block conteudo %}

<!-- Begin Page Content -->
<div class="row text-dark">

  <!-- Page Heading -->
  <form id="my-form" class="col mt-0" action="." method="post">
    <h5 class="m-0 d-flex align-items-center">
      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M0 2C0 0.89543 0.895431 0 2 0H10C11.1046 0 12 0.895431 12 2V4H14C15.1046 4 16 4.89543 16 6V14C16 15.1046 15.1046 16 14 16H6C4.89543 16 4 15.1046 4 14V12H2C0.89543 12 0 11.1046 0 10V2ZM5 12V14C5 14.5523 5.44772 15 6 15H14C14.5523 15 15 14.5523 15 14V6C15 5.44772 14.5523 5 14 5H12V10C12 11.1046 11.1046 12 10 12H5ZM11 4V2C11 1.44772 10.5523 1 10 1H2C1.44772 1 1 1.44772 1 2V10C1 10.5523 1.44772 11 2 11H4V6C4 4.89543 4.89543 4 6 4H11Z" />
      </svg>
      <span>Variáveis de contraste e correlação</span>
    </h5>
    <hr class="mt-0 mb-2" />
    <div class="row d-flex">
      <div class="col-md-8">
        {% csrf_token %}
        {{ form.questao|as_crispy_field }}
      </div>
      <div class="col-md-4">
        {% csrf_token %}
        {{ form.ano|as_crispy_field }}
      </div>
    </div>

    <h5 class="mt-0 mb-0 d-flex align-items-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-funnel me-2"
        viewBox="0 0 16 16">
        <path
          d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z" />
      </svg>
      <span>Filtros</span>
    </h5>

    <hr class="mt-0 mb-2" />
    <div class="row d-flex">
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.sexo|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.escola|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.cor|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.estado_civil|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.deficiencia|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.nacionalidade|as_crispy_field }}
      </div>
      <div id="teste" class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.tp_adm_escola|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.estado|as_crispy_field }}
      </div>
      <div class="col-md-2">
        {% csrf_token %}
        {{ form_filtro.cidade|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.localizacao_da_escola|as_crispy_field }}
      </div>
      <div id="teste" class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.ano_de_conclusao|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        {{ form_filtro.recurso|as_crispy_field }}
      </div>
      <div class="col-md-3">
        {% csrf_token %}
        <div>
          {{ form_filtro.amostra|as_crispy_field }} </div>
      </div>
      <div class="row col">
        <div class="col d-flex align-items-center justify-content-center">
          <button id="preloader2" name="button" value="gerar_analise" type="submit" class="btn btn-outline-primary">
            Gerar Análise
            <svg xmlns="http://www.w3.org/2000/svg" width="86" height="44" fill="currentColor"
              class="bi bi-clipboard-data" viewBox="0 0 16 16">
              <path
                d="M4 11a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1zm6-4a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V7zM7 9a1 1 0 0 1 2 0v3a1 1 0 1 1-2 0V9z" />
              <path
                d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" />
              <path
                d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    <div class="loading" id="preloader">
      <h4 class="loading_preloader justify-content-center align-items-center">
        Processar todos os dados pode tornar o processo mais pesado e, por isso, pode levar um tempo para ser concluído.
      </h4>
    </div>
    <div class="loading_processando" id="preloader_processando">
      <h4 class="loading_preloader_processando justify-content-center align-items-center">
        Processando...
      </h4>
    </div>
    <hr id="progressbar">
</div>


<div class="text-dark rounded border border-dark">


  <div class="col-md-12">
    <h5 class="mt-2 mb-0">{{ menssagem }}</h5>
    <hr class="mt-0 mb-3 bg-dark" />
    <div>
      <h6>
        O número total de alunos após a aplicação do filtro é:
        {{quantidadeParcial}}
      </h6>
      <h6>
        O número total de alunos que se inscreveram no Enem:
        {{quantidadeTotal}}
      </h6>
    </div>
  </div>
  <!-- Relatório em formato de dados brutos -->
  <div class="row">
    <div class="col-md-12">
      <hr class="mt-0 mb-3 bg-dark" />
      <div class="col md-11">{{relatorio_dados_brutos|safe}}</div>
    </div>
  </div>
  <hr class="mb-3" />
  <div class="mb-3 row col">
    <div class="col d-flex align-items-center justify-content-end">
      <!-- <div class="col-md-2 d-flex align-items-center justify-content-end">
        <button name="button" value="baixar_excel" id="preloader2" type="submit"
          class="btn btn-outline-success align-items-center">

          <span>Baixar dados como EXCEL</span>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M14 4.5V14C14 15.1046 13.1046 16 12 16H11V15H12C12.5523 15 13 14.5523 13 14V4.5H11C10.1716 4.5 9.5 3.82843 9.5 3V1H4C3.44772 1 3 1.44772 3 2V11H2V2C2 0.89543 2.89543 0 4 0H9.5L14 4.5ZM2.5752 15.2016H0.785156V14.1293H2.46973V13.5229H0.785156V12.4975H2.5752V11.85H0V15.849H2.5752V15.2016ZM6.30937 11.85H5.41582L4.59258 13.2885H4.55742L3.72539 11.85H2.79375L4.02129 13.8334L2.78203 15.849H3.64336L4.4959 14.434H4.53105L5.38066 15.849H6.28887L5.03496 13.8568L6.30937 11.85ZM7.33359 15.2016H9.12363V15.849H6.54844V11.85H9.12363V12.4975H7.33359V13.5229H9.01816V14.1293H7.33359V15.2016Z" />
          </svg>

        </button>
      </div> -->
      <div class="col-md-2 d-flex align-items-center justify-content-end">
        <a id="button_csv_reduzido" href="" class="btn btn-outline-primary" style="display: none;">
          Baixar dados como CSV
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-csv"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM3.517 14.841a1.13 1.13 0 0 0 .401.823c.13.108.289.192.478.252.19.061.411.091.665.091.338 0 .624-.053.859-.158.236-.105.416-.252.539-.44.125-.189.187-.408.187-.656 0-.224-.045-.41-.134-.56a1.001 1.001 0 0 0-.375-.357 2.027 2.027 0 0 0-.566-.21l-.621-.144a.97.97 0 0 1-.404-.176.37.37 0 0 1-.144-.299c0-.156.062-.284.185-.384.125-.101.296-.152.512-.152.143 0 .266.023.37.068a.624.624 0 0 1 .246.181.56.56 0 0 1 .12.258h.75a1.092 1.092 0 0 0-.2-.566 1.21 1.21 0 0 0-.5-.41 1.813 1.813 0 0 0-.78-.152c-.293 0-.551.05-.776.15-.225.099-.4.24-.527.421-.127.182-.19.395-.19.639 0 .201.04.376.122.524.082.149.2.27.352.367.152.095.332.167.539.213l.618.144c.207.049.361.113.463.193a.387.387 0 0 1 .152.326.505.505 0 0 1-.085.29.559.559 0 0 1-.255.193c-.111.047-.249.07-.413.07-.117 0-.223-.013-.32-.04a.838.838 0 0 1-.248-.115.578.578 0 0 1-.255-.384h-.765ZM.806 13.693c0-.248.034-.46.102-.633a.868.868 0 0 1 .302-.399.814.814 0 0 1 .475-.137c.15 0 .283.032.398.097a.7.7 0 0 1 .272.26.85.85 0 0 1 .12.381h.765v-.072a1.33 1.33 0 0 0-.466-.964 1.441 1.441 0 0 0-.489-.272 1.838 1.838 0 0 0-.606-.097c-.356 0-.66.074-.911.223-.25.148-.44.359-.572.632-.13.274-.196.6-.196.979v.498c0 .379.064.704.193.976.131.271.322.48.572.626.25.145.554.217.914.217.293 0 .554-.055.785-.164.23-.11.414-.26.55-.454a1.27 1.27 0 0 0 .226-.674v-.076h-.764a.799.799 0 0 1-.118.363.7.7 0 0 1-.272.25.874.874 0 0 1-.401.087.845.845 0 0 1-.478-.132.833.833 0 0 1-.299-.392 1.699 1.699 0 0 1-.102-.627v-.495Zm8.239 2.238h-.953l-1.338-3.999h.917l.896 3.138h.038l.888-3.138h.879l-1.327 4Z" />
          </svg>
        </a>
      </div>
      <div class="col-md-3 d-flex align-items-center justify-content-end">
        <button name="button" value="baixar_csv_completo" id="preloader2" type="submit" class="btn btn-outline-primary">
          Baixar CSV com todas as colunas do banco
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-csv"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM3.517 14.841a1.13 1.13 0 0 0 .401.823c.13.108.289.192.478.252.19.061.411.091.665.091.338 0 .624-.053.859-.158.236-.105.416-.252.539-.44.125-.189.187-.408.187-.656 0-.224-.045-.41-.134-.56a1.001 1.001 0 0 0-.375-.357 2.027 2.027 0 0 0-.566-.21l-.621-.144a.97.97 0 0 1-.404-.176.37.37 0 0 1-.144-.299c0-.156.062-.284.185-.384.125-.101.296-.152.512-.152.143 0 .266.023.37.068a.624.624 0 0 1 .246.181.56.56 0 0 1 .12.258h.75a1.092 1.092 0 0 0-.2-.566 1.21 1.21 0 0 0-.5-.41 1.813 1.813 0 0 0-.78-.152c-.293 0-.551.05-.776.15-.225.099-.4.24-.527.421-.127.182-.19.395-.19.639 0 .201.04.376.122.524.082.149.2.27.352.367.152.095.332.167.539.213l.618.144c.207.049.361.113.463.193a.387.387 0 0 1 .152.326.505.505 0 0 1-.085.29.559.559 0 0 1-.255.193c-.111.047-.249.07-.413.07-.117 0-.223-.013-.32-.04a.838.838 0 0 1-.248-.115.578.578 0 0 1-.255-.384h-.765ZM.806 13.693c0-.248.034-.46.102-.633a.868.868 0 0 1 .302-.399.814.814 0 0 1 .475-.137c.15 0 .283.032.398.097a.7.7 0 0 1 .272.26.85.85 0 0 1 .12.381h.765v-.072a1.33 1.33 0 0 0-.466-.964 1.441 1.441 0 0 0-.489-.272 1.838 1.838 0 0 0-.606-.097c-.356 0-.66.074-.911.223-.25.148-.44.359-.572.632-.13.274-.196.6-.196.979v.498c0 .379.064.704.193.976.131.271.322.48.572.626.25.145.554.217.914.217.293 0 .554-.055.785-.164.23-.11.414-.26.55-.454a1.27 1.27 0 0 0 .226-.674v-.076h-.764a.799.799 0 0 1-.118.363.7.7 0 0 1-.272.25.874.874 0 0 1-.401.087.845.845 0 0 1-.478-.132.833.833 0 0 1-.299-.392 1.699 1.699 0 0 1-.102-.627v-.495Zm8.239 2.238h-.953l-1.338-3.999h.917l.896 3.138h.038l.888-3.138h.879l-1.327 4Z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
  </form>

  <!-- Relatório em formato de tabelaa percentual -->
  <div class="row">
    <div class="col-md-12">
      <hr class="mt-0 mb-3 bg-dark" />
      <div id="loading_grafico" class="loading_grafico">
        <div class="loading_grafico_svg"></div>
        <span class="loading_grafico_menssagem">Carregando...</span>
      </div>
    </div>
    <div class="col-md-12">
      <div class="col md-11">{{relatorio_em_tabela|safe}}</div>
    </div>
    <div class="col-md-12">
      <div class="col md-11">{{relatorio_em_grafico|safe}}</div>
      <div class="col-md-12 d-flex aligh-items-center justify-content-center">
        <div class="col-md-12 d-flex justify-content-center">
          {{anotacao_mensagem|safe}}
        </div>
      </div>
    </div>
  </div>
  <hr class="mb-3" />
  <div class="row d-flex justify-content-end align-items-center m-3">
    <button id="sidebarToggle" onclick="imprimirComDelay()" type="button"
      class="downloader__btn btn btn-outline-success print-button">
      Baixar o Relatório
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
        class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
        <path
          d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z" />
        <path
          d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z" />
      </svg>
    </button>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src={% static "js/js_formulario.js" %}></script>
<script src={% static "js/js_geral.js" %} data-filtro-cidade="{{ filtro_cidade }}"></script>

<script>

  var button_csv_reduzido = document.getElementById('button_csv_reduzido');
  var username = "{{ request.user.username }}";
  var filePath_reduzido = "csv/" + username + "/microdados_enem_reduzido.csv";
  var staticRoot_reduzido = "{% static '' %}";
  var timestamp_reduzido = new Date().getTime(); // Obtém o timestamp atual
  var downloadUrl_reduzido = staticRoot_reduzido + filePath_reduzido + "?timestamp=" + timestamp_reduzido;
  button_csv_reduzido.href = downloadUrl_reduzido;
  button_csv_reduzido.style.display = "block";

</script>
{% endblock %}
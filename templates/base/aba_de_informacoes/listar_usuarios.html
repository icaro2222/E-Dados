{% extends 'layout/layout.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block titulo %}E-Dados{% endblock %}
{% block css%}
<link rel="stylesheet" href={% static "css/styles_relatorio.css" %}> {%endblock %}
{% block conteudo %}
<!-- Topbar -->
<nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
  <!-- Topbar Navbar -->
  <ul class="row col-md-12 navbar-nav">
    <li class="col-md-12 nav-item dropdown ml-2 mr-3 text-center">
      <div id="col-md-12 svg-container">
        <div class="col-md-12 d-flex justify-content-between">
          <a class="col-md-4 av-link collapse-item {%if request.resolver_match.url_name == 'cadastrar_usuario' %}text-dark{% endif %} btn d-flex justify-content-center align-items-center"
            href={% url "cadastrar_usuario" %}>
            <span class="m-0 ml-2 d-none d-lg-inline"> Cadastrar Usuário
              <hr class="m-0  {%if request.resolver_match.url_name == 'cadastrar_usuario' %}bg-dark{% endif %}">
            </span>
          </a>
          <a class="col-md-4 av-link collapse-item btn  {%if request.resolver_match.url_name == 'listar_usuarios' %}text-dark{% endif %} d-flex justify-content-center align-items-center"
            href={% url "listar_usuarios" %}>
            <span class="m-0 ml-2 d-none d-lg-inline"> Listar Usuários
              <hr class="m-0  {%if request.resolver_match.url_name == 'listar_usuarios' %}bg-dark{% endif %}">
            </span>
          </a>
          <a class="col-md-4 av-link collapse-item btn  {%if request.resolver_match.url_name == 'log_de_acesso' %}text-dark{% endif %} d-flex justify-content-center align-items-center"
            href={% url "log_de_acesso" %}>
            <span class="m-0 ml-2 d-none d-lg-inline"> Log de Acesso
              <hr class="m-0  {%if request.resolver_match.url_name == 'log_de_acesso' %}bg-dark{% endif %}">
            </span>
          </a>
        </div>
      </div>
    </li>
  </ul>
</nav>

<body>
  <!-- Conteúdo da página -->
  <div class="row border border-dark">
    <div class="col-md-12 text-dark">{{ correcoes }}
      <hr class="mt-0 bg-dark" />
      {% if messages %}
      {% for message in messages %}
      <div class="alert alert-success">
        {{ message }}
      </div>
      {% endfor %}
      {% endif %}

    </div>

    <div class="row col-md-12 ml-4">
      <table>
        <thead>
          <tr>
            <th class="col-md-5 mr-4">Nome</th>
            <th class="col-md-5 mr-4">Email</th>
            <th class="col-md-5 mr-4">editar</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td class="col-md-5 mr-4">{{ user.username }}</td>
            <td class="col-md-5 mr-4">{{ user.email }}</td>
            <td class="col-md-5 mr-4">
              <div class="d-flex">
                <a type="button" class="btn btn-outline-danger delete-button small mr-2" data-toggle="modal"
                  data-target="#excluirModal" title="Excluir" data-username="{{ user.username }}">

                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash"
                    viewBox="0 0 16 16">
                    <path
                      d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z" />
                    <path
                      d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z" />
                  </svg>
                </a>
                <a type="button" class="btn btn-outline-danger small" title="Bloquear">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-x-octagon" viewBox="0 0 16 16">
                    <path
                      d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z" />
                    <path
                      d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                  </svg>
                </a>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Excluir Modal-->
    <div class="modal fade" id="excluirModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Realmente Deseja Excluir Usuário <span
                id="usernamePlaceholder"></span>?</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">Selecioone "Excluir" caso deseje excluir Usuário.</div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
            <form id="excluirForm" method="post" action="{% url 'excluir' %}">
              {% csrf_token %}
              <input type="hidden" name="username" id="usernameInput" value="">
              <button type="submit" class="btn btn-danger" id="btnExcluir">Excluir</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Page Heading -->
    <div class="col-md-12 ">
      <hr class="mb-0" />
      <h6 class="text-dark d-flex ">{{ menssagem }}</h6>
    </div>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function() {
    $('.delete-button').click(function() {
      var username = $(this).data('username');
      $('#usernamePlaceholder').text(username);
      $('#usernameInput').val(username);
    });
    
    $('#excluirModal').on('hidden.bs.modal', function() {
      // Limpar o valor do campo usernameInput quando o modal for fechado
      $('#usernameInput').val('');
    });
  });
</script>


<script>
  setTimeout(function () {
    $('.alert').fadeOut('slow');
  }, 1600);
</script>


<!-- /.container-fluid -->
{% endblock %}